<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>VRT - progress</title>
    <!-- google fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">    
    <!-- Bootstrap icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <!-- My style -->
    <!-- <link rel="stylesheet" href="../style.css"> -->
    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <!-- bootstrap js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <!-- coreui -->
    <script src="https://cdn.jsdelivr.net/npm/@coreui/coreui@5.0.0/dist/js/coreui.bundle.min.js" integrity="sha384-Wl6mLWl+C0OgKzQqXtoEXuTkm2RwXManFDTNyMRxPR5zh3DFIUIDhq7Fp1JCFm1V" crossorigin="anonymous"></script>



    <style>
        /* cancellare */
        body {
            background-color: #e8e8e8;
            font-size: 14px;
        }
        /* tenere */
        .btn-underline {
            border: unset;
            border-bottom: 1px solid blue;
            background: transparent;
        }
        .edit-bando, .btn,
        .dropdown-menu, .myTable, input, select {
            font-size: 14px !important;
            margin-bottom: 0;
        }

        .sidebar-button {
            width: 100%;
            border: unset;
            background-color: #d7d7d7;
            border-radius: 5px !important;
            color: rgb(50, 31, 219)
        }

        table button {
            background-color: transparent;
            border: unset
        }

        button.active {
            background-color: rgb(255, 255, 255);
            color: rgb(118, 129, 146)
        }

        .table td, th {
            white-space: nowrap;
        }

        .dropdown {
            display: none
        }

        .sidebar {
            background-color: transparent
        }

        .dropdown button {
            background-color: white
        }

        @media (max-width: 800px) {
            .dropdown {
                display: block
            }

            .sidebar {
                display: none
            }
        }

        .tab-pane.table-container {
            background-color: white
        }

        .tag {
            background-color: #d7d7d7;
            width: fit-content
        }

        .input-sm{
            font-size:14px;   
        }

        /* bottone download documenti */
        .input-group-append a{
            height: -webkit-fill-available;
            border-top-left-radius:0;
            border-bottom-left-radius:0
        }
        /* arrotonda i bordi input con add-on (applicare allo span) */
        .input-add-on-icon {
            border-top-right-radius: 5.25px !important;
            border-bottom-right-radius: 5.25px !important;
        }
        /* simbolo asterisco su label */
        .form-label:after {
            content: "*";
            color: red;
        }

    </style>  
    
</head>

<body class="d-flex flex-grow-1 px-md-3 mt-4 edit-bando">

    <!-- MODALE AMMINISTRATORE  -->
    <form id="adminModal" class="modal fade needs-validation" novalidate tabindex="-1" aria-labelledby="adminModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title red fs-5">Nuovo amministratore</h1>
              <button type="button" class="btn-close close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="d-flex flex-column gap-3 p-3">
                
                <!-- nome/cognome -->
                <div class="row gap-3 gap-md-0">
                    <div class="col-12 col-md-6">
                        <label for="nomeModale" class="form-label">Nome</label>
                        <input type="text" class="form-control" id="nomeModale" placeholder="" required>
                        <div class="invalid-feedback">
                            Campo obbligatorio
                        </div>
                    </div>
                    <div class="col-12 col-md-6">
                        <label for="cognomeModale" class="form-label">Cognome</label>
                        <input type="text" class="form-control" id="cognomeModale" placeholder="" required>
                        <div class="invalid-feedback">
                            Campo obbligatorio
                        </div>
                    </div>
                </div>
                <!-- email/ruolo -->
                <div class="row gap-3 gap-md-0">
                    <div class="col-12 col-md-6">
                        <label for="emailModale" class="form-label">Email completa</label>
                        <input type="email" class="form-control" id="emailModale" placeholder="name@example.com" required>
                        <div class="invalid-feedback">
                            Fornisci un indirizzo email con formato valido
                        </div>
                    </div>
                    <div class="col-12 col-md-6">
                        <label for="ruoloModale" class="form-label">Ruolo</label>
                        <select class="form-select" aria-label="Default select example" id="ruoloModale" required>
                            <option value="">Scegli il ruolo</option>
                            <option value="1">Amministratore</option>
                            <option value="2">Revisore</option>
                            <option value="3">Sola lettura</option>
                        </select>
                        <div class="invalid-feedback">
                            Scelta obbligatoria
                        </div>
                    </div>
                </div>
                <!-- password -->
                <div class="row gap-3 gap-md-0 mb-3">
                    <div class="col-12 col-md-6">
                        <div>
                            <label for="password" class="form-label">Password</label>
                            <div class="input-group show_hide_password">
                                <input type="password"
                                    class="form-control"
                                    placeholder="Password" aria-label="Username" aria-describedby="basic-addon1"
                                    id="password"
                                    pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,}$"
                                    required>
                                <span class="input-group-text input-add-on-icon" id="basic-addon1">
                                    <i class="bi bi-eye-slash"></i>
                                </span>
                                <label class="lblPassword" style="flex-basis: 100%;font-size: 12.25px;"></label>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-6">
                        <div>
                            <label for="passwordConferma" class="form-label">Conferma password</label>
                            <div class="input-group show_hide_password">
                                <input type="password"
                                    class="form-control"
                                    placeholder="Conferma password"
                                    aria-label="Username" aria-describedby="basic-addon1"
                                    id="passwordConferma"
                                    disabled>
                                <span class="input-group-text input-add-on-icon" id="basic-addon1">
                                    <i class="bi bi-eye-slash"></i>
                                </span>
                                <label id="CheckPasswordMatch" style="flex-basis: 100%;font-size: 12.25px;"></label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="saveAdmin()" class="btn btn-outline-secondary align-items-baseline d-flex gap-2 justify-content-center">
                    SALVA
                </button>
            </div>
          </div>
        </div>
    </form>


    <!-- TABLE AMMINISTRATORI -->
    <div class="container-lg d-flex flex-column">
        
        <div class="tab-pane table-container h-100 pt-2 pt-md-3 px-2 px-md-3 rounded-top" id="lista-aziende">
            <!-- tag -->
            <div class="tag rounded tag-outline align-items-center d-flex gap-2 px-3 py-1 mb-3">
                <i class="bi bi-tags"></i>
                <span>Amministratori</span>
            </div>
            <!--table-->
            <div class="table-responsive mb-5" style="width: 100%;">
                <table class="table-list table-hover table align-middle table-bordered myTable">
                    <thead>
                        <tr>
                            <th scope="col">Nome</th>
                            <th scope="col">Cognome</th>
                            <th scope="col">Email</th>
                            <th scope="col">Ruolo</th>
                            <th scope="col">Controlli</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Victor</td>
                            <td>Velasquez</td>
                            <td>victor@gmail.com</td>
                            <td>Revisore</td>
                            <td>
                                <div class="btn-group pull-right gap-3">
                                    <button onclick="editAdmin()" type="button">
                                        <i class="bi bi-pencil fs-5"></i>
                                    </button>
                                    <button onclick="removeAdmin()" type="button">
                                        <i class="bi bi-trash fs-5"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>Matteo</td>
                            <td>Calderaro</td>
                            <td>matteo@gmail.com</td>
                            <td>Revisore</td>
                            <td>
                                <div class="btn-group pull-right gap-3">
                                    <button onclick="editAdmin()" type="button">
                                        <i class="bi bi-pencil fs-5"></i>
                                    </button>
                                    <button onclick="removeAdmin()" type="button">
                                        <i class="bi bi-trash fs-5"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- button -->
            <button onclick="addAdmin()" type="button" class="btn btn-outline-secondary align-items-center d-flex gap-2 justify-content-center ms-auto">
                Aggiungi amministratore<i class="bi bi-plus-square"></i>
            </button>
        </div>
                     
    </div>

    <script>
        // ICONA X nella modale
        $( document ).ready(function() {
            $('.close').click(() => {
                $("#adminModal").modal('hide');
            })
        });
        
        // BOTTONE AGGIUNGI AMMINISTRATORE
        function addAdmin(){
            $("#adminModal").modal('show');
        }

        // ICONA MODIFICA
        function editAdmin(){
            // ajax GET user data (se 200 apre modale con dati utente)
            $("#adminModal").modal('show');
        }

        // ICONA CESTINO
        function removeAdmin(){
            // ajax DELETE (se 200 ricarica la pagina)
        }

        
        // BOTTONE SALVA NELLA MODALE
        function saveAdmin(){
            let form = document.querySelector('#adminModal')
            testRegularExpression()
            checkPasswordMatch()
            if(form.checkValidity() && $('#password').val().trim() === $('#passwordConferma').val().trim()){
                // ajax POST (se 200 chiude modale e ricarica la pagina)
                $("#adminModal").modal('hide');
            }
        }

    </script>

    <script>
        ////////////////////////
        ////// CHECK PASSWORD
            $('#password').on('keyup', () => {
            testRegularExpression()
        })

        function testRegularExpression() {

            var password = $('#password').val()
            var regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,}$/;
            if (password) {
                if (regex.test(password)) {
                    $('.lblPassword').html('Password valida').css("color", "green");
                    return true
                } else {
                    $('.lblPassword').html('La password deve essere di almeno 8 caratteri e contenere almeno una lettera maiuscola, una minuscola, un numero e un simbolo').css("color", "red");
                    return false
                }
            } else
                $('.lblPassword').html('La password è obbligatoria').css("color", "red")
            return false
        }


        // CHECK CORRISPONDENZA PASSWORD
        $(document).ready(function () {
            $('#password, #passwordConferma').on('keyup', () => checkPasswordMatch())
        })

        function checkPasswordMatch() {

            if (testRegularExpression()) {
                $('#passwordConferma').prop("disabled", false)
                
                if ($('#password').val().trim() == $('#passwordConferma').val().trim()) {

                    $('#CheckPasswordMatch').html('Le password corrispondono').css('color', 'green');
                    $('#passwordConferma').addClass('password-valid')
                    $('#passwordConferma').removeClass('password-invalid')

                } else if ($('#passwordConferma').val()) {

                    $('#CheckPasswordMatch').html('Le password non corrispondono').css('color', 'red');
                    $('#passwordConferma').addClass('password-invalid');
                    $('#passwordConferma').removeClass('password-valid')
                }
                else {

                    $('#CheckPasswordMatch').html('Controllo obbligatorio').css('color', 'red')
                    $('#passwordConferma').removeClass('password-valid')
                    $('#passwordConferma').addClass('password-invalid');
                }
            }
            else {
                $('#passwordConferma').prop("disabled", true)
                $('#CheckPasswordMatch').html('')
                $('#passwordConferma').val('')
            }
        }
    </script>

    <script>
        // data = {
        //     nomeModale: 'Matteo',
        //     cognomeModale: 'Calderaro',
        //     emailModale: 'matteo@gmail.com',
        //     ruoloModale: 1,
        //     password: '1234567Aa@',
        // }
        // MAPPING
        $('#nomeModale').val(data.nomeModale)
        $('#cognomeModale').val(data.cognomeModale)
        $('#emailModale').val(data.emailModale)
        $('#ruoloModale').val(data.ruoloModale)
        $('#password').val(data.password)
    </script>

    <script src="../script.js"></script>

</body>
